<!-- Modern Asset Creation Dialog -->
<div class="dialog-header">
  <div class="header-content">
    <div class="header-icon">
      <mat-icon>engineering</mat-icon>
    </div>
    <div class="header-text">
      <h1>{{ isEditMode ? 'Modifier l\'actif' : 'Créer un nouvel actif' }}</h1>
<p>
  {{ isEditMode 
      ? 'Modifiez les propriétés et la localisation géographique de votre actif'
      : 'Définissez les propriétés et la localisation géographique de votre actif' }}
</p>

    </div>
  </div>
</div>

<mat-dialog-content>
  <!-- Form Section -->
  <section class="form-section">
    <div class="form-container">
      <div class="section-title">
        <mat-icon>settings</mat-icon>
        Informations générales
      </div>
      
      <form [formGroup]="actifForm" class="form-grid">
        <!-- Basic Information -->
        <div class="form-row single">
          <mat-form-field appearance="outline">
            <mat-label>Nom de l'actif</mat-label>
            <input matInput 
                   formControlName="nom" 
                   placeholder="Ex: Grue mobile TC1-A1">
            <mat-icon matSuffix>label</mat-icon>
            <mat-error *ngIf="isFieldInvalid('nom')">
              {{ getFieldError('nom') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row single">
          <mat-form-field appearance="outline">
            <mat-label>Code unique</mat-label>
            <input matInput 
                   formControlName="code" 
                   placeholder="Ex: GM-TC1-A1-001"
                   style="text-transform: uppercase;">
            <mat-icon matSuffix>qr_code</mat-icon>
            <mat-error *ngIf="isFieldInvalid('code')">
              {{ getFieldError('code') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Location Information -->
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Site portuaire</mat-label>
            <mat-select formControlName="site">
              <mat-option *ngFor="let site of siteOptions" [value]="site.value">
                {{ site.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>location_city</mat-icon>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Zone spécifique</mat-label>
            <mat-select formControlName="zone">
              <mat-option *ngFor="let zone of zoneOptions" [value]="zone.value">
                {{ zone.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>map</mat-icon>
          </mat-form-field>
        </div>

        <!-- Classification -->
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Type d'ouvrage</mat-label>
            <mat-select formControlName="ouvrage">
              <mat-option *ngFor="let ouvrage of ouvrageOptions" [value]="ouvrage.value">
                {{ ouvrage.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>construction</mat-icon>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Groupe d'appartenance</mat-label>
            <mat-select formControlName="idGroupe">
              <mat-option *ngFor="let groupe of groupeOptions" [value]="groupe.value">
                {{ groupe.label }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>category</mat-icon>
          </mat-form-field>
        </div>
      </form>
    </div>
  </section>

  <!-- Map Section -->
  <section class="map-section">
    <!-- Map Toolbar -->
    <div class="map-toolbar">
      <div class="geometry-status">
        <div class="status-chip" [class.empty]="!hasGeometry" [class.defined]="hasGeometry">
          <mat-icon>{{ hasGeometry ? 'check_circle' : 'radio_button_unchecked' }}</mat-icon>
          <span>{{ hasGeometry ? 'Géométrie définie' : 'Aucune géométrie' }}</span>
          <span *ngIf="hasGeometry" class="geometry-type">
            ({{ getGeometryTypeLabel(actifForm.get('geometryType')?.value) }})
          </span>
        </div>
        <mat-error *ngIf="isFieldInvalid('coordinates')" class="error-text">
          <mat-icon>warning</mat-icon>
          Géométrie requise
        </mat-error>
      </div>

      <div class="toolbar-actions">
        <!-- Add Geometry Menu -->
        <button *ngIf="!hasGeometry" 
                mat-raised-button 
                class="draw-menu-trigger"
                [matMenuTriggerFor]="drawMenu">
          <mat-icon>add_location_alt</mat-icon>
          Ajouter géométrie
        </button>
        <mat-menu #drawMenu="matMenu">
          <button mat-menu-item (click)="startDrawing('Point')">
            <mat-icon>place</mat-icon>
            <span>Marquer un point</span>
          </button>
          <button mat-menu-item (click)="startDrawing('LineString')">
            <mat-icon>timeline</mat-icon>
            <span>Dessiner une ligne</span>
          </button>
          <button mat-menu-item (click)="startDrawing('Polygon')">
            <mat-icon>crop_free</mat-icon>
            <span>Délimiter une zone</span>
          </button>
        </mat-menu>

        <!-- Edit/Delete Actions -->
        <ng-container *ngIf="hasGeometry">
          <button mat-fab 
                  class="action-button edit"
                  (click)="editGeometry()"
                  matTooltip="Modifier la géométrie">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-fab 
                  class="action-button delete"
                  (click)="deleteGeometry()"
                  matTooltip="Supprimer la géométrie">
            <mat-icon>delete</mat-icon>
          </button>
        </ng-container>
      </div>
    </div>

    <!-- Map Container -->
    <div class="map-container-wrapper">
      <div id="drawing-map"></div>
      
      <!-- Map Controls -->
      <div class="map-controls">
        <button mat-fab 
                class="control-button"
                (click)="centerOnTangerMed()"
                matTooltip="Centrer sur Tanger Med">
          <mat-icon>my_location</mat-icon>
        </button>
        <button mat-fab 
                class="control-button"
                (click)="switchBaseMap()"
                [matTooltip]="isSatelliteView ? 'Vue plan' : 'Vue satellite'">
          <mat-icon>{{ isSatelliteView ? 'map' : 'satellite_alt' }}</mat-icon>
        </button>
      </div>
    </div>
  </section>
</mat-dialog-content>

<!-- Dialog Actions -->
<mat-dialog-actions>
  <div class="actions-left">
    <mat-icon>info</mat-icon>
    <span>Tous les champs marqués * sont obligatoires</span>
  </div>
  
  <div class="actions-right">
    <button mat-stroked-button 
            class="cancel-button"
            (click)="onCancel()">
      Annuler
    </button>
    <button mat-raised-button 
            class="save-button"
            (click)="onSave()" 
            [disabled]="actifForm.invalid || isSaving">
      <div class="button-content">
        <mat-spinner *ngIf="isSaving" diameter="18"></mat-spinner>
        <mat-icon *ngIf="!isSaving">save</mat-icon>
      <span>
  {{ isSaving 
      ? (isEditMode ? 'Modification en cours...' : 'Création en cours...') 
      : (isEditMode ? 'Modifier l\'actif' : 'Créer l\'actif') }}
</span>

      </div>
    </button>
  </div>
</mat-dialog-actions>